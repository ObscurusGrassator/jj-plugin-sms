var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _objectWithoutProperties2=_interopRequireDefault(require("@babel/runtime/helpers/objectWithoutProperties"));var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));var _excluded=["messages","timestamp"];try{var _require=require('react-native'),Linking=_require.Linking;}catch(err){}module.exports=function(){function SMS(options){(0,_classCallCheck2.default)(this,SMS);this.lastMessages='';this.options=options;}return(0,_createClass2.default)(SMS,[{key:"sendRequest",value:(function(){var _sendRequest=(0,_asyncToGenerator2.default)(function*(method){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.options.mobileAppOpen('jjplugin.obsgrass.sms','JJPluginSMSService','MainActivity',[["serviceMethod",method],["input",JSON.stringify(params)]]);});function sendRequest(_x){return _sendRequest.apply(this,arguments);}return sendRequest;}())},{key:"getContactByName",value:(function(){var _getContactByName=(0,_asyncToGenerator2.default)(function*(name){return yield this.sendRequest('getContactByName',{name:name});});function getContactByName(_x2){return _getContactByName.apply(this,arguments);}return getContactByName;}())},{key:"promptToSentMessageContent",value:function(){var _promptToSentMessageContent=(0,_asyncToGenerator2.default)(function*(){return(yield this.options.speech(this.options.translate.messageContentQuestion,true)).text;});function promptToSentMessageContent(){return _promptToSentMessageContent.apply(this,arguments);}return promptToSentMessageContent;}()},{key:"promptToRecipientName",value:function(){var _promptToRecipientName=(0,_asyncToGenerator2.default)(function*(){return(yield this.options.speech(this.options.translate.recipientNameQuestion,true)).text;});function promptToRecipientName(){return _promptToRecipientName.apply(this,arguments);}return promptToRecipientName;}()},{key:"sendMessage",value:(function(){var _sendMessage=(0,_asyncToGenerator2.default)(function*(smsNumber,message,fullName){message=message.replace(/ __? /g,' ');if(yield this.options.getSummaryAccept(this.options.translate.canSendMessage({realName:fullName||smsNumber,message:message}))){this.options.speech(this.options.translate.sendingMessage);try{this.lastChatContact={number:smsNumber,fullName:fullName};yield this.sendRequest('sendSMS',{number:smsNumber,message:message});}catch(err){if(err.toString().toLocaleLowerCase().indexOf('timeout')>-1){yield this.options.speech(this.options.translate.sendingTimeout);}else if(err.toString().toLocaleLowerCase().indexOf('status')>-1){yield this.options.speech(this.options.translate.sendingFailed+' '+err.toString());}else throw err;}return true;}else{return false;}});function sendMessage(_x3,_x4,_x5){return _sendMessage.apply(this,arguments);}return sendMessage;}())},{key:"getMessages",value:(function(){var _getMessages=(0,_asyncToGenerator2.default)(function*(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(options.makrAsReaded)options.setAsRread=options.makrAsReaded;if(options.box=='all')options.box='';if(options.minDateMilliseconds)options.minDate=options.minDateMilliseconds;if(options.maxDateMilliseconds)options.maxDate=options.maxDateMilliseconds;if(options.findMessageByRegex)options.bodyRegex=options.findMessageByRegex;options.read=options.onlyReaded?1:0;if(options.smsFromNumber)options.address=options.smsFromNumber;var result=yield this.sendRequest('getNewSMSs',options);for(var i in result){if(options.makrAsReaded)Linking.openURL(`sms:${result[i].number}`);}if(Object.keys(result).length===1){var _Object$values$=Object.values(result)[0],messages=_Object$values$.messages,timestamp=_Object$values$.timestamp,lastChatContact=(0,_objectWithoutProperties2.default)(_Object$values$,_excluded);this.lastChatContact=lastChatContact;}return result;});function getMessages(){return _getMessages.apply(this,arguments);}return getMessages;}())}]);}();