var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));var _classCallCheck2=_interopRequireDefault(require("@babel/runtime/helpers/classCallCheck"));var _createClass2=_interopRequireDefault(require("@babel/runtime/helpers/createClass"));try{var _require=require('react-native'),Linking=_require.Linking;}catch(err){}module.exports=function(){function SMS(options){(0,_classCallCheck2.default)(this,SMS);this.lastMessages='';this.options=options;}return(0,_createClass2.default)(SMS,[{key:"sendRequest",value:(function(){var _sendRequest=(0,_asyncToGenerator2.default)(function*(method){var params=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};return this.options.mobileAppOpen('jjplugin.obsgrass.sms','JJPluginSMSService','MainActivity',[["serviceMethod",method],["input",JSON.stringify(params)]]);});function sendRequest(_x){return _sendRequest.apply(this,arguments);}return sendRequest;}())},{key:"getContactByName",value:(function(){var _getContactByName=(0,_asyncToGenerator2.default)(function*(name){var constact=yield this.sendRequest('getContactByName',{name:name});if(!constact)throw this.options.translate.realNameNotFound({name:name});return constact;});function getContactByName(_x2){return _getContactByName.apply(this,arguments);}return getContactByName;}())},{key:"promptToSentMessageContent",value:(function(){var _promptToSentMessageContent=(0,_asyncToGenerator2.default)(function*(textInvitingUserToDictateMessage){return(yield this.options.speech(this.options.translate.messageContentQuestion,true)).text;});function promptToSentMessageContent(_x3){return _promptToSentMessageContent.apply(this,arguments);}return promptToSentMessageContent;}())},{key:"promptToRecipientName",value:(function(){var _promptToRecipientName=(0,_asyncToGenerator2.default)(function*(textInvitingUserToDictateRecipientName){return(yield this.options.speech(this.options.translate.recipientNameQuestion,true)).text;});function promptToRecipientName(_x4){return _promptToRecipientName.apply(this,arguments);}return promptToRecipientName;}())},{key:"sendMessage",value:(function(){var _sendMessage=(0,_asyncToGenerator2.default)(function*(smsNumber,message,fullName){message=message.replace(/ __? /g,' ');if(yield this.options.getSummaryAccept(this.options.translate.canSendMessage({realName:fullName||smsNumber,message:message}))){this.options.speech(this.options.translate.sendingMessage);try{yield this.sendRequest('sendSMS',{number:smsNumber,message:message});}catch(err){if(err.toString().toLocaleLowerCase().indexOf('status')>-1){this.options.speech(this.options.translate.sendingFailed);this.options.speech(err.toString(),false,{speakDisable:true});}if(err.toString().toLocaleLowerCase().indexOf('timeout')>-1)this.options.speech(this.options.translate.sendingTimeout);else throw err;}return true;}else{return false;}});function sendMessage(_x5,_x6,_x7){return _sendMessage.apply(this,arguments);}return sendMessage;}())},{key:"getMessages",value:(function(){var _getMessages=(0,_asyncToGenerator2.default)(function*(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(options.makrAsReaded)options.setAsRread=options.makrAsReaded;if(options.box=='all')options.box='';if(options.minDateMilliseconds)options.minDate=options.minDateMilliseconds;if(options.maxDateMilliseconds)options.maxDate=options.maxDateMilliseconds;if(options.findMessageByRegex)options.bodyRegex=options.findMessageByRegex;options.read=options.onlyReaded?1:0;if(options.smsFromNumber)options.address=options.smsFromNumber;var result=yield this.sendRequest('getNewSMSs',options);for(var i in result){if(options.makrAsReaded)Linking.openURL(`sms:${result[i].number}`);}return result;});function getMessages(){return _getMessages.apply(this,arguments);}return getMessages;}())}]);}();