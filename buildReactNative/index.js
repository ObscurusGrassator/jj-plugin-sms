var _interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault");var _asyncToGenerator2=_interopRequireDefault(require("@babel/runtime/helpers/asyncToGenerator"));try{var _require=require('react-native'),Linking=_require.Linking,NativeModules=_require.NativeModules;var AppLink=require('react-native-app-link');var global=require('global');}catch(err){}function readableNumber(number){var result='';number=(''+number).replace(/(.)/g,'$1 ');for(var i=number.length-1-6;i>=-5;i-=6){result=number.substring(i)+'. '+result;number=number.substring(0,i);}return result;}function sendRequest(_x,_x2){return _sendRequest.apply(this,arguments);}function _sendRequest(){_sendRequest=(0,_asyncToGenerator2.default)(function*(ctx,method){var params=arguments.length>2&&arguments[2]!==undefined?arguments[2]:{};var requestID=Date.now()+'';return new Promise(function(){var _ref5=(0,_asyncToGenerator2.default)(function*(res,rej){global.requestResult[requestID]=res;NativeModules.OpenApp.openApp('jjplugin.obsgrass.sms','JJPluginSMSService',requestID,method,JSON.stringify(params));setTimeout(function(){delete global.requestResult[requestID];rej(`Aplikácia pluginu "jjPluginSMS" neodpovedá!`);},10000);});return function(_x8,_x9){return _ref5.apply(this,arguments);};}()).then(function(){var _ref6=(0,_asyncToGenerator2.default)(function*(result){delete global.requestResult[requestID];if(result.error){if(result.error.indexOf('ermission')>-1)yield ctx.speech('Skontrolujte prosím pridelené oprávnenia pre SMS plugin.');return Promise.reject(result.error);}else{return result;}});return function(_x10){return _ref6.apply(this,arguments);};}());});return _sendRequest.apply(this,arguments);}module.exports=require("server/types/pluginFunctions.cjs").addPlugin({"sms":{"automatic":{"checkNewMessage":{"type":"boolean","value":true}}}},{"os":{"android":true},"pluginFormatVersion":1},{"scriptPerInterval":function(){var _scriptPerInterval=(0,_asyncToGenerator2.default)(function*(ctx){if(!ctx.config.sms.automatic.checkNewMessage.value)return;try{var newMessages=Object.values((yield sendRequest(ctx,'getNewSMSs')).result);if(newMessages&&newMessages.length){if(newMessages.length>1)yield ctx.speech('Máš nové SMS od '+newMessages.map(function(a){return a.fullName||/[a-z]/i.test(a.number)&&a.number||'čísla: '+readableNumber(a.number);}).join(', ').replace(/, ([^,]+)$/,' a $1'));if(newMessages.length===1)yield ctx.speech('Máš novú SMS od '+(newMessages[0].fullName||/[a-z]/i.test(newMessages[0].number)&&newMessages[0].number||'čísla: '+readableNumber(newMessages[0].number)));}}catch(err){ctx.speech(err,false,{speakDisable:true});}});function scriptPerInterval(_x3){return _scriptPerInterval.apply(this,arguments);}return scriptPerInterval;}()},{"sentenceMemberRequirements":{"_or":[{"example":"Písal mi niekto?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":/(na|od)písať/}]}]},"objects":[{"multiple":[{"origWord":/niekto/}]}]},{"example":"Mám nejaké nové správy?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":/mať|prísť/}]}]},"objects":[{"multiple":[{"baseWord":[/správa/,/sms/]}]}]}]}},function(){var _ref=(0,_asyncToGenerator2.default)(function*(ctx){try{yield ctx.speech('Pozriem SMSky...');var newMessages=Object.values((yield sendRequest(ctx,'getNewSMSs')).result);if((newMessages==null?void 0:newMessages.length)>1)yield ctx.speech('Máš nové SMS od '+newMessages.map(function(a){return a.fullName||/[a-z]/i.test(a.number)&&a.number||'čísla: '+readableNumber(a.number);}).join(', ').replace(/, ([^,]+)$/,' a $1'));if((newMessages==null?void 0:newMessages.length)===1)yield ctx.speech('Máš novú SMS od '+(newMessages[0].fullName||/[a-z]/i.test(newMessages[0].number)&&newMessages[0].number||'čísla: '+readableNumber(newMessages[0].number)));if(!newMessages||newMessages.length===0)yield ctx.speech('Nemáš žiadne nové SMSky');}catch(err){ctx.speech(err,false,{speakDisable:true});}});return function(_x4){return _ref.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"_or":[{"example":"Prečítaj mi nové správy!","type":"command","predicates":{"multiple":[{"verbs":[{"baseWord":/prečítať/}]}]},"objects":[{"multiple":[{"origWord":[/správy/,/ich/,/sms/]}]}]}]}},function(){var _ref2=(0,_asyncToGenerator2.default)(function*(ctx){try{yield ctx.speech('Pozriem SMSky...');var newMessages=Object.values((yield sendRequest(ctx,'getNewSMSs',{setAsRread:true})).result);if(newMessages.length===0)yield ctx.speech('Nemáš žiadne nové SMSky');else for(var sms of newMessages){Linking.openURL(`sms:${sms.number}`);yield ctx.speech(`${sms.fullName||/[a-z]/i.test(sms.number)&&sms.number||'Číslo: '+readableNumber(sms.number)} píše, ${sms.messages.join(', ')},`);}}catch(err){ctx.speech(err,false,{speakDisable:true});}});return function(_x5){return _ref2.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"example":"Čo mi píše <subject>?","type":"question","predicates":{"multiple":[{"verbs":[{"baseWord":[/(na|od)písať/]}]}]},"subjects":{"multiple":[{"propName":{"friend":"required"}}]},"objects":[{"multiple":[{"origWord":/čo/}]}]}},function(){var _ref3=(0,_asyncToGenerator2.default)(function*(ctx){try{yield ctx.speech('Pozriem SMSky...');var contact=yield sendRequest(ctx,'getContactByName',{name:ctx.propName.friend.baseWord});if(!contact.fullName){yield ctx.speech(`${ctx.propName.friend.baseWord} som v kontaktoch nenašiel.`);return;}var newMessages=Object.values((yield sendRequest(ctx,'getNewSMSs',{faddress:contact.number,setAsRread:true})).result);var sms=newMessages.find(function(sms){return sms.fullName;});if(!sms)yield ctx.speech(`${contact.fullName} ti nenapísal žiadnu novú SMS.`);else yield ctx.speech(`${contact.fullName} píše, ${sms.messages.join(', ')}`);}catch(err){ctx.speech(err,false,{speakDisable:true});}});return function(_x6){return _ref3.apply(this,arguments);};}(),{"sentenceMemberRequirements":{"example":"Napíš správu pre <object> citujem ... koniec citácie!","type":"command","predicates":{"multiple":[{"verbs":[{"baseWord":[/(na|od)písať/,/(od|p)oslať/]}]}]},"objects":[{"multiple":[{"origWord":[/správu/,/sms(ku)?/]}]},{"multiple":[{"_or":[{"case":{"key":"3"}},{"preposition":{"origWord":"pre"}}]}],"propName":{"friend":"required"}}]}},function(){var _ref4=(0,_asyncToGenerator2.default)(function*(ctx){try{var friends=ctx.propName.friend.multiple.map(function(f){return f.baseWord;});var constacts=[];var unfindedNames=[];for(var friend of friends){var constact=yield sendRequest(ctx,'getContactByName',{name:friend});if(constact.fullName)constacts.push(constact);else unfindedNames.push(friend);}if(unfindedNames.length){yield ctx.speech((unfindedNames.length>1?'Mená':'Meno')+unfindedNames.join(' a ')+' som v kontaktoch nenašiel.');}else{if(!ctx.propName.citation){var _yield$ctx$speech=yield ctx.speech('Môžeš diktovať SMS',true),text=_yield$ctx$speech.text;ctx.propName.citation=text;}else yield ctx.speech('Posielam SMS...');if(yield ctx.getSummaryAccept('FacebookChat plugin: Poslať správu '+(Object.values(constacts).length===1?'priateľovi: ':'priateľom: ')+Object.values(constacts).map(function(a){return a.fullName;}).join(', ')+' s textom: '+ctx.propName.citation)){for(var _constact of constacts){yield sendRequest(ctx,'sendSMS',{number:_constact.phoneNumbers[0].number,message:ctx.propName.citation});}yield ctx.speech('Odoslané...');}}}catch(err){ctx.speech(err,false,{speakDisable:true});}});return function(_x7){return _ref4.apply(this,arguments);};}());